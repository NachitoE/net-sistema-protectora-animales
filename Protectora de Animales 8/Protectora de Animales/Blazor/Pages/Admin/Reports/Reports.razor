@page "/reports-menu"
@inject IDownloadHandler DownloadHandler;

<MudButton 
    
    Variant="Variant.Filled"
           Color="Color.Primary"
    StartIcon="@GetCurrentIcon("ADOPTION_MONTH_REPORT")"
           Disabled="@(!GetButtonActiveStatus("ADOPTION_MONTH_REPORT"))"
               OnClick="OnDownloadClickAdoptionMonthReport">Descargar Adopciones de este mes</MudButton>

<MudButton Variant="Variant.Filled"
           Color="Color.Primary"
           StartIcon="@GetCurrentIcon("ANIMALS_HISTORY_REPORT")"
           Disabled="@(!GetButtonActiveStatus("ANIMALS_HISTORY_REPORT"))"
           OnClick="OnDownloadClickAnimalHistoriesReport">Descargar historial de todos los animales</MudButton>

@code {
    private bool isDownloadingAdoptionMonthReport = false;
    private bool isDownloadingAnimalHistoriesReport = false;
    private async Task OnDownloadClickAdoptionMonthReport()
    {
        isDownloadingAdoptionMonthReport = true;
        var reportCli = ApiClientsFactory.ReportClient(DownloadHandler);
        var res = await reportCli.DownloadAdoptionMonthReportAsync();
        if (!res.Success)
        {
            Snackbar.Add("Error al descargar el reporte de adopciones del mes: " + res.Message, Severity.Error);
        }
        isDownloadingAdoptionMonthReport = false;
    }
    private async Task OnDownloadClickAnimalHistoriesReport()
    {
        isDownloadingAnimalHistoriesReport = true;
        var reportCli = ApiClientsFactory.ReportClient(DownloadHandler);
        var res = await reportCli.DownloadAnimalsHistoryAsync();
        if (!res.Success)
        {
            Snackbar.Add("Error al descargar el reporte de historial de animales: " + res.Message, Severity.Error);
        }
        isDownloadingAnimalHistoriesReport = false;
    }
    private string GetCurrentIcon(string btnId)
    {
        if(btnId == "ADOPTION_MONTH_REPORT" && isDownloadingAdoptionMonthReport)
        {
            return Icons.Material.Filled.Downloading;
        }
        if (btnId == "ANIMALS_HISTORY_REPORT" && isDownloadingAnimalHistoriesReport)
        {
            return Icons.Material.Filled.Downloading;
        }
        //another button check
        return Icons.Material.Filled.Download;
    }
    private bool GetButtonActiveStatus(string btnId)
    {
        if (btnId == "ADOPTION_MONTH_REPORT" && isDownloadingAdoptionMonthReport)
        {
            return false;
        }
        if (btnId == "ANIMALS_HISTORY_REPORT" && isDownloadingAnimalHistoriesReport)
        {
            return false;
        }
        //another button check
        return true;
    }

}
