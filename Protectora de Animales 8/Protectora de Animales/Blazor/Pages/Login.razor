@using Infrastructure.API
@using DTOs

<form>
    <div class="form-group">
        <label for="usernameInput">Usuario:</label>
        <input type="text" class="form-control" id="usernameInput" placeholder="Usuario" @bind="@userName">
    </div>
    <div class="form-group">
        <label for="passwordInput">Contraseña:</label>
        <input type="password" class="form-control" id="passwordInput" placeholder="Contraseña" @bind="@password">
    </div>
</form>
<button class="btn btn-primary mt-3" @onclick="@OnClick">Ingresar</button>
<div>@status</div>
@code {
    private string userName { get; set; }
    private string password { get; set; }

    private string status { get; set; }

    [Parameter]
    public Action<UserDTO, string>? OnLoginSuccess { get; set; }

    private async Task OnClick()
    {
        status = "Entrando...";
        AuthClient authClient = ApiClientsFactory.AuthClient();
        var res = await authClient.LoginAsync(new UserLoginRequestDTO() { UserName = userName, Password = password });
        if (!res.Success || res.Data == null)
        {
            status = res.Message;
            return;
        }
        string token = res.Data.Token;
        if (OnLoginSuccess != null && !string.IsNullOrEmpty(token))
            OnLoginSuccess(res.Data.User!, token);

        status = "Algo terrible pasó. Vuelve a intentarlo";
    }

}
